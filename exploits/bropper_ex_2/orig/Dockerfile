FROM gcc

# Set working directory
WORKDIR /app

# Install any required packages (if needed, add socat or others)
RUN apt-get update && apt-get install -y socat

# Copy source files
COPY chall_fork.c /app/chall_fork.c
COPY serve.c /app/serve.c
COPY serve.h /app/serve.h
#COPY lib /app/lib
#COPY ibcs.new /app/ibcs.new

# Compile the C files
RUN gcc -save-temps=obj -fpie -fstack-protector /app/serve.c /app/chall_fork.c -o /app/server

# Expose port (you can set the appropriate port if needed)
EXPOSE 1337

# Set the entrypoint to the compiled binary
ENTRYPOINT ["/app/server"]