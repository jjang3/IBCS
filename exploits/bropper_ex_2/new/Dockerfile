FROM gcc

# Set working directory
WORKDIR /app

# Install any required packages (if needed, add socat or others)
RUN apt-get update && apt-get install -y socat

# Define a build argument for the file source path
ARG SOURCE_PATH=.

# Use the build argument to copy the files dynamically
COPY ${SOURCE_PATH}/lib /app/lib
COPY ${SOURCE_PATH}/ibcs.new /app/ibcs.new

# Expose port (you can set the appropriate port if needed)
EXPOSE 1337

# Set the entrypoint to run the ibcs.new with LD_PRELOAD
ENTRYPOINT ["sh", "-c", "LD_PRELOAD=/app/lib/table.so /app/ibcs.new"]